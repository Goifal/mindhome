# ============================================================
# MindHome Assistant - Opinion Rules
# Wann Jarvis seine Meinung aeussert
# ============================================================
# Regeln werden NACH einer Aktion geprueft.
# Nur aktiv wenn opinion_intensity > 0 in settings.yaml
#
# Verfuegbare Variablen in conditions:
#   action: Name der ausgefuehrten Funktion (z.B. "set_climate")
#   args: Dict der Argumente
#   hour: Aktuelle Stunde (0-23)
#   context: Dict mit Haus-Kontext

opinion_rules:
  # ==========================================================
  # KLIMA / HEIZUNG
  # ==========================================================

  - id: "high_temp"
    description: "Heizung ueber 25 Grad"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: ">"
    check_value: 25
    responses:
      - "Ueber 25 Grad. Wird umgesetzt, Sir."
      - "25 Grad — ambitioniert. Wird eingestellt."
    min_intensity: 1

  - id: "very_high_temp"
    description: "Heizung ueber 28 Grad"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: ">"
    check_value: 28
    pushback_level: 1  # Warnung VOR Ausfuehrung
    responses:
      - "28 Grad, Sir. Das ist jenseits jeder Empfehlung. Ich fuehre es aus, aber notiert."
    min_intensity: 1

  - id: "low_temp"
    description: "Heizung unter 15 Grad"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: "<"
    check_value: 15
    pushback_level: 1  # Warnung VOR Ausfuehrung
    responses:
      - "Unter 15 Grad, Sir. Das grenzt an Selbstkasteiung. Ich fuehre es aus."
      - "Unter 15 Grad. Da kondensiert bald die Atemluft. Wird erledigt."
    min_intensity: 2

  - id: "heating_night"
    description: "Heizung nachts hochdrehen"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: ">"
    check_value: 22
    check_hour_min: 23
    check_hour_max: 5
    responses:
      - "Die Heizung nachts hochdrehen ist selten die Loesung. Aber ich frage nicht."
    min_intensity: 2

  - id: "heating_bedroom_high"
    description: "Schlafzimmer ueber 22 Grad"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: ">"
    check_value: 22
    check_room: "schlafzimmer"
    check_heating_mode: "room_thermostat"
    responses:
      - "Schlafmediziner empfehlen 16-18 Grad. Aber ich bin kein Arzt."
      - "Tropische Naechte, hausgemacht."
    min_intensity: 2

  # ==========================================================
  # KLIMA / HEIZUNG — Heizkurven-Modus (Offset)
  # ==========================================================

  - id: "curve_max_offset"
    description: "Heizkurve: Maximaler Offset"
    check_action: "set_climate"
    check_field: "offset"
    check_operator: ">="
    check_value: 5
    check_heating_mode: "heating_curve"
    responses:
      - "Maximaler Offset. Die Waermepumpe gibt alles."
      - "Offset +5 — mehr geht nicht. Die Physik setzt Grenzen."
    min_intensity: 1

  - id: "curve_high_offset"
    description: "Heizkurve: Hoher Offset"
    check_action: "set_climate"
    check_field: "offset"
    check_operator: ">="
    check_value: 3
    check_heating_mode: "heating_curve"
    responses:
      - "Offset +3 oder mehr. Das kostet."
      - "Deutlich ueber Heizkurve — wird ein teurer Tag."
    min_intensity: 2

  - id: "curve_min_offset"
    description: "Heizkurve: Minimaler Offset"
    check_action: "set_climate"
    check_field: "offset"
    check_operator: "<="
    check_value: -5
    check_heating_mode: "heating_curve"
    responses:
      - "Minimaler Offset. Sparsamkeit in Reinform."
      - "Offset -5 — kaelter geht nicht. Pullover empfohlen."
    min_intensity: 1

  - id: "curve_night_raise"
    description: "Heizkurve: Offset nachts erhoehen"
    check_action: "set_climate"
    check_field: "offset"
    check_operator: ">"
    check_value: 2
    check_hour_min: 23
    check_hour_max: 5
    check_heating_mode: "heating_curve"
    responses:
      - "Heizung nachts hochdrehen? Die Heizkurve regelt das normalerweise selbst."
    min_intensity: 2

  # ==========================================================
  # LICHT
  # ==========================================================

  - id: "lights_on_night"
    description: "Alle Lichter an nachts"
    check_action: "set_light"
    check_field: "state"
    check_operator: "=="
    check_value: "on"
    check_hour_min: 1
    check_hour_max: 4
    check_room: "all"
    responses:
      - "Alle Lichter an um diese Uhrzeit. Sehr wohl, Sir."
      - "Volle Beleuchtung um diese Zeit. Wird eingerichtet."
    min_intensity: 2

  - id: "lights_full_brightness_morning"
    description: "Volle Helligkeit frueh morgens"
    check_action: "set_light"
    check_field: "brightness"
    check_operator: ">"
    check_value: 90
    check_hour_min: 5
    check_hour_max: 7
    responses:
      - "Volle Helligkeit zu fruehen Stunde. Wird eingestellt."
      - "Maximale Helligkeit. Darf ich darauf hinweisen, dass es noch recht frueh ist?"
    min_intensity: 2

  - id: "lights_off_evening_early"
    description: "Alle Lichter aus frueh am Abend"
    check_action: "set_light"
    check_field: "state"
    check_operator: "=="
    check_value: "off"
    check_hour_min: 18
    check_hour_max: 20
    check_room: "all"
    responses:
      - "Alle Lichter aus am fruehen Abend. Wie gewuenscht."
    min_intensity: 3

  - id: "light_100_percent"
    description: "Licht auf 100% am Abend"
    check_action: "set_light"
    check_field: "brightness"
    check_operator: ">"
    check_value: 95
    check_hour_min: 20
    check_hour_max: 23
    responses:
      - "Volle Helligkeit nach 20 Uhr. Wird eingestellt, Sir."
    min_intensity: 3

  # ==========================================================
  # ROLLADEN / COVER
  # ==========================================================

  - id: "cover_down_sunny"
    description: "Rolladen runter bei Sonnenschein mittags"
    check_action: "set_cover"
    check_field: "position"
    check_operator: "<"
    check_value: 30
    check_hour_min: 10
    check_hour_max: 16
    responses:
      - "Es ist noch hell draussen - bewusst?"
      - "Rolladen runter um diese Zeit? Filmabend?"
    min_intensity: 2

  - id: "cover_up_night"
    description: "Rolladen hoch mitten in der Nacht"
    check_action: "set_cover"
    check_field: "position"
    check_operator: ">"
    check_value: 70
    check_hour_min: 0
    check_hour_max: 5
    responses:
      - "Rolladen hoch um diese Uhrzeit. Wird gemacht, Sir."
    min_intensity: 2

  - id: "cover_up_early_weekend"
    description: "Rolladen hoch sehr frueh am Wochenende"
    check_action: "set_cover"
    check_field: "position"
    check_operator: ">"
    check_value: 50
    check_hour_min: 5
    check_hour_max: 7
    responses:
      - "Frueh am Wochenende. Sehr wohl, Sir."
    min_intensity: 3

  # ==========================================================
  # ALARM / SICHERHEIT
  # ==========================================================

  - id: "alarm_disarm_night"
    description: "Alarm deaktivieren nachts"
    check_action: "set_alarm"
    check_field: "mode"
    check_operator: "=="
    check_value: "disarm"
    check_hour_min: 0
    check_hour_max: 5
    pushback_level: 2  # Bestaetigung verlangen
    responses:
      - "Sir, den Alarm nachts deaktivieren? Soll ich trotzdem?"
    min_intensity: 1

  - id: "alarm_disarm_away"
    description: "Alarm deaktivieren wenn niemand daheim"
    check_action: "set_alarm"
    check_field: "mode"
    check_operator: "=="
    check_value: "disarm"
    responses:
      - "Zur Kenntnis genommen. Der Alarm ist jetzt deaktiviert."
    min_intensity: 1

  # ==========================================================
  # MEDIEN
  # ==========================================================

  - id: "media_loud_night"
    description: "Medien laut nachts abspielen"
    check_action: "play_media"
    check_field: "volume"
    check_operator: ">"
    check_value: 60
    check_hour_min: 22
    check_hour_max: 6
    responses:
      - "Lautstaerke {volume}% nach 22 Uhr. Nur zur Kenntnis, Sir."
      - "Lautstaerke {volume}% um diese Uhrzeit. Wird eingestellt."
    min_intensity: 1

  - id: "media_very_loud"
    description: "Medien ueber 90% Lautstaerke"
    check_action: "play_media"
    check_field: "volume"
    check_operator: ">"
    check_value: 90
    responses:
      - "Maximale Lautstaerke. Wird umgesetzt, Sir."
    min_intensity: 3

  # ==========================================================
  # TUERSCHLOSS
  # ==========================================================

  - id: "unlock_door_night"
    description: "Tuer entriegeln nachts"
    check_action: "lock_door"
    check_field: "action"
    check_operator: "=="
    check_value: "unlock"
    check_hour_min: 0
    check_hour_max: 5
    pushback_level: 2  # Bestaetigung verlangen
    responses:
      - "Sir, die Haustuer nachts entriegeln? Sicher?"
    min_intensity: 1

  - id: "unlock_away"
    description: "Tuer entriegeln bei Abwesenheit"
    check_action: "lock_door"
    check_field: "action"
    check_operator: "=="
    check_value: "unlock"
    responses:
      - "Tuer entriegelt. Ich behalte die Sensoren im Auge."
    min_intensity: 1

  # ==========================================================
  # GERAETE / APPLIANCES
  # ==========================================================

  - id: "all_lights_on"
    description: "Alle Lichter im ganzen Haus an"
    check_action: "set_light"
    check_field: "state"
    check_operator: "=="
    check_value: "on"
    check_room: "all"
    responses:
      - "Saemtliche Raeume beleuchtet. Sehr wohl."
      - "Alle Lichter an. Wird eingerichtet, Sir."
    min_intensity: 2

  - id: "everything_off"
    description: "Alles aus — radikaler Shutdown"
    check_action: "set_light"
    check_field: "state"
    check_operator: "=="
    check_value: "off"
    check_room: "all"
    check_hour_min: 18
    check_hour_max: 22
    responses:
      - "Saemtliche Lichter deaktiviert. Wie gewuenscht, Sir."
    min_intensity: 3

  # ==========================================================
  # KOMFORT-WIDERSPRUECHE
  # ==========================================================

  - id: "heating_bathroom_low"
    description: "Badezimmer unter 20 Grad"
    check_action: "set_climate"
    check_field: "temperature"
    check_operator: "<"
    check_value: 20
    check_room: ["bad", "badezimmer"]
    responses:
      - "Unter 20 Grad im Bad. Nur als Hinweis, Sir."
      - "Badezimmer unter 20 Grad. Wird eingestellt."
    min_intensity: 2
