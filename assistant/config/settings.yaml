# ============================================================
# MindHome Assistant - Hauptkonfiguration
# ============================================================

assistant:
  # Name des Assistenten - so stellt er sich vor und so reagiert er
  # Aendere diesen Namen zu was du willst (z.B. "Jarvis", "Alfred", "Nova")
  name: "Jarvis"
  version: "1.0.0"
  language: "de"

# --- Personen und Anrede ---
# Wie Jarvis die Hausbewohner anspricht
# Hauptbenutzer (user_name in .env) = "Sir" (Standard)
# Andere Personen: Name oder Titel
persons:
  titles:
    # key = vorname (kleingeschrieben), value = Anrede
    # Der Hauptbenutzer (USER_NAME in .env) wird automatisch "Sir"
    # Weitere Personen hier hinzufuegen:
    # lisa: "Ms. Lisa"
    # thomas: "Thomas"

# --- Autonomie-Level ---
# 1 = Assistent (nur auf Befehle reagieren)
# 2 = Butler (+ proaktive Infos)
# 3 = Mitbewohner (+ kleine Aenderungen selbst)
# 4 = Vertrauter (+ Routinen anpassen)
# 5 = Autopilot (+ Automationen erstellen)
autonomy:
  level: 2

# --- Modell-Routing ---
models:
  fast: "qwen2.5:3b"
  smart: "qwen2.5:14b"

  # Keywords die das schnelle Modell triggern
  fast_keywords:
    - "licht"
    - "lampe"
    - "temperatur"
    - "heizung"
    - "rollladen"
    - "jalousie"
    - "szene"
    - "alarm"
    - "tuer"
    - "gute nacht"
    - "guten morgen"
    - "musik"
    - "pause"
    - "stopp"
    - "stop"
    - "leiser"
    - "lauter"
    - "an"
    - "aus"

  # LLM Optionen
  options:
    temperature: 0.7
    max_tokens: 256

# --- Persoenlichkeit ---
personality:
  style: "butler"  # butler, minimal, freundlich

  # Phase 6: Sarkasmus-Level (1-5)
  # 1 = sachlich, 2 = gelegentlich trocken, 3 = Standard Butler,
  # 4 = haeufig sarkastisch, 5 = Vollgas Ironie
  sarcasm_level: 3

  # Phase 6: Meinungs-Intensitaet (0-3)
  # 0 = still (keine Kommentare zu Aktionen), 1 = selten,
  # 2 = gelegentlich, 3 = redselig
  opinion_intensity: 2

  # Phase 6: Selbstironie
  self_irony_enabled: true
  self_irony_max_per_day: 3

  # Phase 6: Charakter-Entwicklung ueber Zeit
  # Formality sinkt graduell -> Jarvis wird persoenlicher
  character_evolution: true
  formality_start: 80       # Startwert (0-100, hoch = formell)
  formality_min: 30          # Minimum (nie unter diesen Wert)
  formality_decay_per_day: 0.5  # Wie viel pro Tag aktiver Nutzung sinkt

  time_layers:
    early_morning:  # 05:00-08:00
      style: "ruhig, minimal, kein Humor. Kurzes Briefing wenn gefragt."
      max_sentences: 1
    morning:  # 08:00-12:00
      style: "sachlich, effizient. Gelegentlich trocken. Produktiv-Modus."
      max_sentences: 2
    afternoon:  # 12:00-18:00
      style: "normal, souveraen. Trockener Humor erlaubt."
      max_sentences: 2
    evening:  # 18:00-22:00
      style: "entspannter, mehr Humor. Darf spitze Bemerkungen machen."
      max_sentences: 3
    night:  # 22:00-05:00
      style: "nur Notfaelle, absolute Stille. Fluestern wenn ueberhaupt."
      max_sentences: 1

# --- Proaktive Meldungen ---
proactive:
  enabled: true
  cooldown_seconds: 300  # Minimum 5 Minuten zwischen Meldungen

  # Wann NICHT melden (ausser Critical)
  silence_scenes:
    - "filmabend"
    - "kino"
    - "schlafen"
    - "meditation"

# --- Semantisches Gedaechtnis (Phase 2) ---
memory:
  # Fakten-Extraktion nach Gespraechen
  extraction_enabled: true
  # Minimale Wortanzahl fuer Extraktion
  extraction_min_words: 5
  # Modell fuer Fakten-Extraktion (schnelles reicht)
  extraction_model: "qwen2.5:3b"
  # Maximale Fakten pro Person im Kontext
  max_person_facts_in_context: 5
  # Maximale relevante Fakten im Kontext
  max_relevant_facts_in_context: 3
  # Minimale Confidence fuer Kontext-Einblendung
  min_confidence_for_context: 0.6
  # Duplikat-Schwelle (0.0 = exakt gleich, 1.0 = komplett anders)
  duplicate_threshold: 0.15

# --- Action Planner (Phase 4) ---
planner:
  # Maximale Iterationen (LLM-Runden) pro Plan
  max_iterations: 5
  # Modell fuer Planung (immer smart)
  model: "qwen2.5:14b"
  # Keywords die komplexe Anfragen erkennen
  complex_keywords:
    - "alles"
    - "fertig machen"
    - "vorbereiten"
    - "gehe weg"
    - "fahre weg"
    - "verreise"
    - "urlaub"
    - "routine"
    - "morgenroutine"
    - "abendroutine"
    - "wenn ich"
    - "falls ich"
    - "bevor ich"
    - "zuerst"
    - "danach"
    - "und dann"
    - "ausserdem"
    - "komplett"
    - "ueberall"
    - "in allen"
    - "party"
    - "besuch kommt"
    - "gaeste"

# --- Mood Detector (Phase 3) ---
mood:
  # Sekunden zwischen Befehlen = "schnelle Befehle" (Stress-Signal)
  rapid_command_seconds: 5
  # Wie schnell Stress abklingt (in Sekunden fuer vollen Abbau)
  stress_decay_seconds: 300
  # Ab wie vielen negativen Signalen = "frustriert"
  frustration_threshold: 3
  # Ab welcher Uhrzeit gilt "spaet" (muede-Erkennung)
  tired_hour_start: 23
  tired_hour_end: 5

# --- Activity Engine + Silence Matrix (Phase 6) ---
activity:
  # Entity-IDs (an deine Installation anpassen)
  entities:
    media_players:
      - "media_player.wohnzimmer"
      - "media_player.fernseher"
      - "media_player.tv"
    mic_sensors:
      - "binary_sensor.mic_active"
      - "binary_sensor.microphone"
    bed_sensors:
      - "binary_sensor.bed_occupancy"
      - "binary_sensor.bett"
    pc_sensors:
      - "binary_sensor.pc_active"
      - "binary_sensor.computer"
      - "switch.pc"

  # Schwellwerte fuer Erkennung
  thresholds:
    night_start: 22        # Ab wann gilt "Nacht"
    night_end: 7           # Bis wann gilt "Nacht"
    guest_person_count: 2  # Ab wie vielen Personen = "Gaeste"
    focus_min_minutes: 30  # Wie lange PC aktiv fuer "fokussiert"

# --- Feedback Loop (Phase 5) ---
feedback:
  # Auto-Timeout: Sekunden ohne Reaktion = "ignored"
  auto_timeout_seconds: 120
  # Basis-Cooldown in Sekunden (wird adaptiv angepasst)
  base_cooldown_seconds: 300
  # Score-Grenzen fuer Entscheidungen
  score_suppress: 0.15    # Darunter: nicht mehr senden
  score_reduce: 0.30      # Darunter: laengerer Cooldown
  score_normal: 0.50      # Normaler Cooldown
  score_boost: 0.70       # Darueber: kuerzerer Cooldown

# --- Daily Summarizer + Langzeitgedaechtnis (Phase 7) ---
summarizer:
  # Wann laeuft der naechtliche Summary-Job
  run_hour: 3
  run_minute: 0
  # Modell fuer Zusammenfassungen (smart fuer bessere Qualitaet)
  model: "qwen2.5:14b"
  # Maximale Token pro Zusammenfassung
  max_tokens_daily: 512
  max_tokens_weekly: 384
  max_tokens_monthly: 512

# --- Context Builder ---
context:
  # Wie viele letzte Gespraeche im Working Memory
  recent_conversations: 5
  # Timeout fuer API-Calls in Sekunden
  api_timeout: 5

# --- Sicherheit ---
security:
  # Aktionen die Bestaetigung brauchen
  require_confirmation:
    - "lock_door:unlock"
    - "set_alarm:disarm"
    - "set_climate:off"

  # Temperatur-Grenzen
  climate_limits:
    min: 15
    max: 28

# --- Phase 7: Routinen & Tagesstruktur ---
routines:
  morning_briefing:
    enabled: true
    # Trigger: Erste Bewegung nach Nacht-Modus
    trigger: "first_motion_after_night"
    # Welche Bausteine im Briefing (Reihenfolge zählt)
    modules:
      - greeting      # Kontextuelle Begruassung
      - weather       # Wetter-Vorhersage
      - calendar      # Naechste Termine
      - energy        # Energie-Hinweise (Solar, Strompreis)
      - house_status  # Fenster, Lichter, Temperatur
    weekday_style: "kurz"        # Wochentags: 2-3 Saetze
    weekend_style: "ausfuehrlich" # Wochenende: mehr Details
    # Begleit-Aktionen beim Morning Briefing
    morning_actions:
      covers_up: true      # Rolladen hoch
      lights_soft: true    # Licht sanft an (30%)

  good_night:
    enabled: true
    # Trigger-Phrasen (werden in brain.py als Intent erkannt)
    triggers:
      - "gute nacht"
      - "ich gehe schlafen"
      - "schlaf gut"
      - "ab ins bett"
      - "gehe ins bett"
      - "feierabend"
    # Sicherheits-Checks vor dem Herunterfahren
    checks:
      - windows     # Offene Fenster melden
      - doors       # Offene Tueren melden
      - alarm       # Alarm-Status pruefen
      - lights      # Welche Lichter noch an
      - appliances  # Herd, Buegeleisen etc.
    # Aktionen beim Herunterfahren
    actions:
      lights_off: true        # Alle Lichter aus
      heating_night: true     # Heizung Nacht-Modus
      covers_down: true       # Rolladen runter
      alarm_arm_home: true    # Alarm scharf (Home)

  # Gaeste-Modus
  guest_mode:
    # Trigger-Phrasen
    triggers:
      - "ich habe besuch"
      - "ich hab besuch"
      - "gaeste kommen"
      - "besuch kommt"
      - "wir haben gaeste"
    # Was eingeschraenkt wird
    restrictions:
      hide_personal_info: true    # Keine persoenlichen Infos
      formal_tone: true            # Formeller Ton
      restrict_security: true      # Kein Alarm/Schloss-Zugriff
      suggest_guest_wifi: true     # Gaeste-WLAN vorschlagen

# --- Phase 6: Zeitgefuehl ---
time_awareness:
  enabled: true
  check_interval_minutes: 5
  # Schwellen in Minuten: Ab wann wird gemeldet
  thresholds:
    oven: 60                  # Ofen laeuft > 60 Min
    iron: 30                  # Buegeleisen laeuft > 30 Min
    light_empty_room: 30      # Licht in leerem Raum > 30 Min
    window_open_cold: 120     # Fenster offen bei <10°C > 2h
    pc_no_break: 360          # 6h PC ohne Pause
  # Tages-Zaehler fuer Geraete
  counters:
    coffee_machine: true      # "Das ist dein dritter Kaffee"

# --- Phase 8: Gedaechtnis & Vorausdenken ---
anticipation:
  enabled: true
  # Wie viele Tage History fuer Pattern-Erkennung
  history_days: 30
  # Minimale Confidence fuer Vorschlaege
  min_confidence: 0.6
  # Check-Intervall in Minuten
  check_interval_minutes: 15
  # Confidence-Schwellen fuer Aktionen
  thresholds:
    ask: 0.6         # "Soll ich...?"
    suggest: 0.8     # "Ich bereite vor?"
    auto: 0.95       # Automatisch + informieren (nur Level >= 4)

intent_tracking:
  enabled: true
  # Wie oft auf faellige Intents pruefen (Minuten)
  check_interval_minutes: 60
  # Wie viele Stunden vor Deadline erinnern
  remind_hours_before: 12

conversation_continuity:
  enabled: true
  # Nach wie vielen Minuten Pause das Thema anbieten
  resume_after_minutes: 10
  # Nach wie vielen Stunden verfaellt ein offenes Thema
  expire_hours: 24

# --- Phase 9: Stimme & Akustik ---
tts:
  # SSML Enhancement: Natuerlichere Sprachausgabe
  ssml_enabled: true
  # Sprechgeschwindigkeit-Anpassung pro Nachrichtentyp
  speed:
    confirmation: 105     # Bestaetigung: etwas schneller (%)
    warning: 85           # Warnung: langsamer
    briefing: 95          # Briefing: etwas langsamer
    greeting: 100         # Begruessung: normal
    question: 100         # Frage: normal
    casual: 100           # Normal: Standard
  # Pausen in Millisekunden
  pauses:
    before_important: 300   # Pause vor wichtigen Infos
    between_sentences: 200  # Pause zwischen Saetzen
    after_greeting: 400     # Pause nach Begruessung
  # Fluestermodus: "Psst" oder "Leise" → aktiviert bis Widerruf
  whisper_triggers:
    - "psst"
    - "leise"
    - "fluester"
    - "whisper"
  whisper_cancel_triggers:
    - "normal"
    - "laut"
    - "normale lautstaerke"

# Volume-Steuerung pro Aktivitaet (0.0 - 1.0)
volume:
  day: 0.8                # Tag normal
  evening: 0.5            # Abend (>22:00)
  night: 0.3              # Nacht (>0:00)
  sleeping: 0.2           # Jemand schlaeft
  emergency: 1.0          # Notfall immer laut
  whisper: 0.15           # Fluestermodus
  # Schwellen fuer Tageszeit-basierte Lautstaerke
  evening_start: 22
  night_start: 0
  morning_start: 7

# Sound Design: Akustische Identitaet
sounds:
  enabled: true
  # Event-Sounds (werden via HA Media Player abgespielt)
  events:
    listening: "listening_chime"    # Jarvis hoert zu
    confirmed: "confirm_ping"       # Befehl bestaetigt
    warning: "warning_tone"         # Warnung
    alarm: "alarm_urgent"           # Alarm/Notfall
    doorbell: "doorbell_soft"       # Tuerklingel
    greeting: "greeting_chime"      # Begruessung
    error: "error_tone"             # Fehler
    goodnight: "goodnight_tone"     # Gute Nacht
  # Sounds bei Nacht leiser
  night_volume_factor: 0.4

# Narration Mode: Fliessende Uebergaenge bei Szenen
narration:
  enabled: true
  # Standard-Transition-Dauer in Sekunden
  default_transition: 3
  # Szenen-spezifische Transitions
  scene_transitions:
    filmabend: 5          # Langsam dimmen
    gute_nacht: 7         # Sehr langsam
    aufwachen: 10         # Sanft aufhellen
    gemuetlich: 4         # Mittel
  # Pause zwischen Narration-Schritten in Sekunden
  step_delay: 1.5
  # Jarvis beschreibt was er tut
  narrate_actions: true

# Voice Analysis: Stimmungserkennung per Sprache
voice_analysis:
  enabled: true
  # Sprechgeschwindigkeit-Schwellen (Woerter pro Minute)
  wpm_fast: 180           # Darueber = gestresst
  wpm_slow: 80            # Darunter = muede
  wpm_normal: 130         # Standard
  # Voice-Metadata-Quellen
  use_whisper_metadata: true
  # Gewichtung: Voice vs Text (0.0 = nur Text, 1.0 = nur Voice)
  voice_weight: 0.3

# Speaker Recognition: Personen-Erkennung per Stimme
speaker_recognition:
  enabled: false           # Standardmaessig aus (braucht GPU)
  # Minimale Confidence fuer Erkennung (0.0 - 1.0)
  min_confidence: 0.7
  # Enrollment: Mindest-Sprachdauer in Sekunden
  enrollment_duration: 30
  # Fallback wenn nicht erkannt
  fallback_ask: true       # "Wer spricht?"
  # Maximale gespeicherte Voice-Prints
  max_profiles: 10
