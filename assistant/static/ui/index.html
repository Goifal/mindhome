<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jarvis — MindHome Dashboard</title>
<style>
/* ============================================================
   MindHome Design System — Jarvis Dashboard v2
   Dark futuristic, amber accents, Outfit font
   ============================================================ */
/* Offline-Fonts: System-Fonts statt Google CDN (Offline-Prinzip) */
@font-face {
  font-family: 'Outfit';
  font-style: normal;
  font-weight: 300 700;
  font-display: swap;
  src: local('Outfit'), local('Inter'), local('Segoe UI');
}
@font-face {
  font-family: 'JetBrains Mono';
  font-style: normal;
  font-weight: 400 500;
  font-display: swap;
  src: local('JetBrains Mono'), local('SF Mono'), local('Consolas'), local('Menlo');
}

:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-card: #1a2035;
  --bg-card-hover: #1f2847;
  --bg-input: #151d30;
  --bg-overlay: rgba(10, 14, 23, 0.85);
  --text-primary: #e8ecf4;
  --text-secondary: #8892a8;
  --text-muted: #5a6478;
  --accent: #f59e0b;
  --accent-dim: rgba(245, 158, 11, 0.15);
  --accent-glow: rgba(245, 158, 11, 0.3);
  --blue: #3b82f6;
  --blue-dim: rgba(59, 130, 246, 0.15);
  --success: #10b981;
  --success-dim: rgba(16, 185, 129, 0.15);
  --danger: #ef4444;
  --danger-dim: rgba(239, 68, 68, 0.15);
  --border: rgba(255, 255, 255, 0.06);
  --border-hover: rgba(255, 255, 255, 0.12);
  --border-accent: rgba(245, 158, 11, 0.3);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
  --shadow-glow: 0 0 20px rgba(245, 158, 11, 0.15);
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --font: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
  --mono: 'JetBrains Mono', 'SF Mono', monospace;
  --sidebar-w: 220px;
  --header-h: 56px;
  --fast: 0.15s ease;
  --normal: 0.25s ease;
}

* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:var(--font); background:var(--bg-primary); color:var(--text-primary); min-height:100vh; overflow-x:hidden; background-image: radial-gradient(rgba(245,158,11,0.03) 1px, transparent 1px); background-size: 28px 28px; }

/* ---- Login HUD ---- */
.login-screen { display:flex; align-items:center; justify-content:center; min-height:100vh; background: radial-gradient(ellipse at center, rgba(245,158,11,0.03) 0%, var(--bg-primary) 70%); overflow: hidden; }
.login-box { background: rgba(26,32,53,0.85); border: 1px solid var(--border-accent); border-radius:var(--radius-lg); padding:48px 40px; width:360px; text-align:center; box-shadow: var(--shadow-lg), var(--shadow-glow); position: relative; backdrop-filter: blur(12px); }
.login-box h1 { font-size:28px; font-weight:600; margin-bottom:8px; color:var(--accent); letter-spacing: 4px; }
.login-box p { color:var(--text-secondary); margin-bottom:32px; font-size:14px; text-transform: uppercase; letter-spacing: 2px; font-family: var(--mono); }
.login-box input { width:100%; padding:14px 16px; background:var(--bg-input); border:1px solid var(--border-accent); border-radius:var(--radius-sm); color:var(--text-primary); font-family:var(--mono); font-size:24px; text-align:center; letter-spacing:12px; outline:none; transition: border-color var(--fast), box-shadow var(--fast); }
.login-box input:focus { border-color:var(--accent); box-shadow: 0 0 20px rgba(245,158,11,0.2); }
.login-box input::placeholder { letter-spacing:4px; font-size:14px; color:var(--text-muted); }
.login-box button { width:100%; margin-top:20px; padding:14px; background:var(--accent); color:#0a0e17; border:none; border-radius:var(--radius-sm); font-family:var(--font); font-size:16px; font-weight:600; cursor:pointer; text-transform: uppercase; letter-spacing: 2px; transition: all var(--fast); }
.login-box button:hover { opacity:0.9; box-shadow: 0 0 20px rgba(245,158,11,0.3); }
.login-error { color:var(--danger); font-size:13px; margin-top:12px; min-height:20px; }
.login-icon { font-size:44px; margin-bottom:14px; }
.login-box input + input { margin-top:12px; }
.login-box .recovery-hint { color:var(--accent); font-weight:600; margin-bottom:16px; }
.login-box .recovery-desc { margin-bottom:20px; font-size:13px; }
.login-box .recovery-key-display { background:var(--bg-input); border:2px solid var(--accent); border-radius:var(--radius-sm); padding:18px; font-family:var(--mono); font-size:22px; letter-spacing:4px; color:var(--accent); margin-bottom:20px; user-select:all; }
.login-box .forgot-pin { margin-top:20px; }
.login-box .forgot-pin a { color:var(--text-muted); font-size:12px; text-decoration:none; }
.login-box .forgot-pin a:hover { color:var(--accent); }
.login-box .reset-input { margin-bottom:12px; letter-spacing:2px; text-transform:uppercase; }
.login-hud-ring { position: absolute; top: -60px; left: 50%; transform: translateX(-50%); width: 120px; height: 120px; }
.login-hud-ring svg { width: 100%; height: 100%; animation: hudSpin 8s linear infinite; }
.login-hud-arc { fill: none; stroke: var(--accent); stroke-width: 1.5; stroke-dasharray: 40 20; opacity: 0.6; }
.login-hud-arc-inner { fill: none; stroke: rgba(245,158,11,0.3); stroke-width: 1; stroke-dasharray: 15 25; opacity: 0.4; }
.login-scan-line { position: absolute; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, var(--accent), transparent); opacity: 0.3; animation: scanDown 3s ease-in-out infinite; }
.login-corner { position: absolute; width: 16px; height: 16px; border-color: var(--accent); opacity: 0.4; }
.login-corner.tl { top: 8px; left: 8px; border-top: 1px solid; border-left: 1px solid; }
.login-corner.tr { top: 8px; right: 8px; border-top: 1px solid; border-right: 1px solid; }
.login-corner.bl { bottom: 8px; left: 8px; border-bottom: 1px solid; border-left: 1px solid; }
.login-corner.br { bottom: 8px; right: 8px; border-bottom: 1px solid; border-right: 1px solid; }
@keyframes hudSpin { to { transform: rotate(360deg); } }
@keyframes scanDown { 0%,100% { top: 10%; } 50% { top: 90%; } }

/* ---- App ---- */
.app { display:none; }
.app.active { display:flex; min-height:100vh; }

/* Sidebar */
.sidebar { width:var(--sidebar-w); background:var(--bg-secondary); border-right:1px solid var(--border-accent); display:flex; flex-direction:column; position:fixed; top:0; left:0; bottom:0; z-index:100; overflow:hidden; }
.sidebar::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:linear-gradient(180deg, rgba(245,158,11,0.04) 0%, transparent 40%, transparent 60%, rgba(245,158,11,0.02) 100%); pointer-events:none; z-index:0; }
.sidebar::after { content:''; position:absolute; left:0; right:0; height:1px; background:linear-gradient(90deg, transparent, var(--accent), transparent); opacity:0.15; animation:sidebarScan 6s ease-in-out infinite; pointer-events:none; z-index:1; }
@keyframes sidebarScan { 0%,100% { top:5%; } 50% { top:95%; } }
.sidebar-logo { padding:18px 20px; border-bottom:1px solid var(--border-accent); display:flex; align-items:center; gap:12px; position:relative; z-index:2; }
.sidebar-logo .logo-icon { width:36px; height:36px; border:1.5px solid var(--accent); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:700; color:var(--accent); font-family:var(--mono); box-shadow:0 0 12px rgba(245,158,11,0.2), inset 0 0 8px rgba(245,158,11,0.1); animation:logoGlow 3s ease-in-out infinite; }
@keyframes logoGlow { 0%,100% { box-shadow:0 0 12px rgba(245,158,11,0.2), inset 0 0 8px rgba(245,158,11,0.1); } 50% { box-shadow:0 0 20px rgba(245,158,11,0.35), inset 0 0 12px rgba(245,158,11,0.15); } }
.sidebar-logo h2 { font-size:17px; font-weight:600; letter-spacing:3px; color:var(--accent); }
.sidebar-logo span { font-size:9px; color:var(--text-muted); display:block; text-transform:uppercase; letter-spacing:2px; }
.sidebar-nav { padding:12px 8px; flex:1; overflow-y:auto; position:relative; z-index:2; }
.nav-item { display:flex; align-items:center; gap:10px; padding:10px 14px; border-radius:var(--radius-sm); color:var(--text-secondary); cursor:pointer; font-size:13px; font-weight:500; margin-bottom:2px; transition:all var(--fast); border:1px solid transparent; text-transform:uppercase; letter-spacing:0.5px; font-size:12px; }
.nav-item:hover { background:rgba(245,158,11,0.05); color:var(--text-primary); border-color:rgba(245,158,11,0.1); }
.nav-item.active { background:var(--accent-dim); color:var(--accent); border-color:var(--border-accent); box-shadow:0 0 10px rgba(245,158,11,0.1); }
.nav-item.active::before { content:''; position:absolute; left:0; width:2px; height:24px; background:var(--accent); border-radius:0 2px 2px 0; box-shadow:0 0 8px var(--accent); }
.nav-item .nav-icon { width:18px; text-align:center; font-size:14px; }
.sidebar-footer { padding:12px; border-top:1px solid var(--border-accent); font-size:10px; color:var(--text-muted); text-align:center; position:relative; z-index:2; font-family:var(--mono); letter-spacing:1px; text-transform:uppercase; }

/* Main */
.main { margin-left:var(--sidebar-w); flex:1; min-height:100vh; }
.main-header { height:var(--header-h); border-bottom:1px solid var(--border-accent); display:flex; align-items:center; justify-content:space-between; padding:0 28px; background:rgba(17,24,39,0.92); backdrop-filter:blur(12px); position:sticky; top:0; z-index:50; }
.main-header::after { content:''; position:absolute; bottom:-1px; left:0; right:0; height:1px; background:linear-gradient(90deg, transparent, var(--accent), transparent); opacity:0.3; }
.main-header h1 { font-size:15px; font-weight:600; text-transform:uppercase; letter-spacing:2px; color:var(--text-secondary); }
.main-content { padding:28px; }

/* Responsive */
@media (max-width:900px) {
  .sidebar { transform:translateX(-100%); transition:transform var(--normal); }
  .sidebar.open { transform:translateX(0); }
  .main { margin-left:0; }
  .mobile-toggle { display:flex !important; }
}

/* Pages */
.page { display:none; }
.page.active { display:block; }

/* Grid */
.grid { display:grid; gap:16px; }
.grid-2 { grid-template-columns:repeat(2,1fr); }
.grid-3 { grid-template-columns:repeat(3,1fr); }
.grid-4 { grid-template-columns:repeat(4,1fr); }
@media (max-width:1200px) { .grid-4 { grid-template-columns:repeat(2,1fr); } }
@media (max-width:900px) { .grid-2,.grid-3,.grid-4 { grid-template-columns:1fr; } }

/* Card */
.card { background:var(--bg-card); border:1px solid rgba(245,158,11,0.12); border-radius:var(--radius-md); padding:20px; margin-bottom:16px; position:relative; transition:all var(--normal); }
.card::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg, transparent, rgba(245,158,11,0.4), transparent); border-radius:var(--radius-md) var(--radius-md) 0 0; }
.card:hover { border-color:var(--border-accent); box-shadow:0 0 20px rgba(245,158,11,0.08); }
.card-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
.card-header h3 { font-size:14px; font-weight:600; text-transform:uppercase; letter-spacing:1px; color:var(--accent); }

/* Stat */
.stat-card { background:var(--bg-card); border:1px solid rgba(245,158,11,0.12); border-radius:var(--radius-md); padding:18px 20px; position:relative; overflow:hidden; transition:all var(--normal); }
.stat-card::before { content:''; position:absolute; top:0; left:0; width:3px; height:100%; background:linear-gradient(180deg, var(--accent), transparent); border-radius:var(--radius-md) 0 0 var(--radius-md); }
.stat-card::after { content:''; position:absolute; top:0; right:0; bottom:0; width:40%; background:radial-gradient(ellipse at right, rgba(245,158,11,0.03), transparent); pointer-events:none; }
.stat-card:hover { border-color:var(--border-accent); box-shadow:0 0 20px rgba(245,158,11,0.1); transform:translateY(-1px); }
.stat-label { font-size:10px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:8px; font-family:var(--mono); }
.stat-value { font-size:28px; font-weight:700; font-family:var(--mono); color:var(--accent); text-shadow:0 0 20px rgba(245,158,11,0.2); }
.stat-sub { font-size:11px; color:var(--text-secondary); margin-top:4px; font-family:var(--mono); }

/* Form */
.form-group { margin-bottom:16px; }
.form-group label { display:block; font-size:11px; font-weight:600; color:var(--text-muted); margin-bottom:6px; text-transform:uppercase; letter-spacing:1px; }
.form-group .hint { font-size:11px; color:var(--text-muted); margin-top:3px; }
input[type="text"],input[type="number"],input:not([type]),select,textarea { width:100%; padding:9px 12px; background:var(--bg-input); border:1px solid rgba(245,158,11,0.1); border-radius:var(--radius-sm); color:var(--text-primary); font-family:var(--font); font-size:13px; outline:none; transition:all var(--fast); }
input:focus,select:focus,textarea:focus { border-color:var(--accent); box-shadow:0 0 12px rgba(245,158,11,0.1); }
select { cursor:pointer; }
textarea { resize:vertical; min-height:70px; font-family:var(--mono); font-size:12px; }

/* Range */
.range-group { display:flex; align-items:center; gap:14px; }
.range-group input[type="range"] { flex:1; -webkit-appearance:none; height:3px; background:rgba(245,158,11,0.15); border-radius:2px; border:none; outline:none; }
.range-group input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:var(--accent); cursor:pointer; box-shadow:0 0 12px rgba(245,158,11,0.5); border:2px solid rgba(245,158,11,0.8); }
.range-value { min-width:40px; text-align:center; font-family:var(--mono); font-size:14px; font-weight:700; color:var(--accent); text-shadow:0 0 10px rgba(245,158,11,0.3); }

/* Toggle */
.toggle-group { display:flex; align-items:center; justify-content:space-between; }
.toggle { position:relative; width:42px; height:22px; cursor:pointer; }
.toggle input { display:none; }
.toggle-track { position:absolute; inset:0; background:var(--bg-input); border:1px solid rgba(245,158,11,0.15); border-radius:11px; transition:all var(--fast); }
.toggle input:checked + .toggle-track { background:var(--accent-dim); border-color:var(--accent); box-shadow:0 0 10px rgba(245,158,11,0.2); }
.toggle-thumb { position:absolute; top:3px; left:3px; width:16px; height:16px; border-radius:50%; background:var(--text-muted); transition:all var(--fast); }
.toggle input:checked ~ .toggle-thumb { left:23px; background:var(--accent); box-shadow:0 0 8px rgba(245,158,11,0.4); }

/* Buttons */
.btn { display:inline-flex; align-items:center; gap:8px; padding:9px 18px; border:none; border-radius:var(--radius-sm); font-family:var(--font); font-size:12px; font-weight:600; cursor:pointer; transition:all var(--fast); text-transform:uppercase; letter-spacing:1px; }
.btn-primary { background:var(--accent); color:#0a0e17; box-shadow:0 0 10px rgba(245,158,11,0.2); }
.btn-primary:hover { opacity:0.9; box-shadow:0 0 20px rgba(245,158,11,0.4); }
.btn-secondary { background:transparent; color:var(--text-primary); border:1px solid var(--border-accent); }
.btn-secondary:hover { border-color:var(--accent); background:rgba(245,158,11,0.05); box-shadow:0 0 10px rgba(245,158,11,0.1); }
.btn-danger { background:transparent; color:var(--danger); border:1px solid rgba(239,68,68,0.3); }
.btn-danger:hover { border-color:var(--danger); background:var(--danger-dim); }
.btn-sm { padding:5px 12px; font-size:11px; }

/* Tab Bar */
.tab-bar { display:flex; gap:2px; background:rgba(21,29,48,0.5); padding:3px; border-radius:var(--radius-sm); margin-bottom:20px; flex-wrap:wrap; border:1px solid rgba(245,158,11,0.08); }
.tab-item { padding:7px 14px; border-radius:6px; font-size:11px; font-weight:500; color:var(--text-secondary); cursor:pointer; transition:all var(--fast); white-space:nowrap; text-transform:uppercase; letter-spacing:0.5px; }
.tab-item:hover { color:var(--text-primary); background:rgba(245,158,11,0.05); }
.tab-item.active { background:rgba(245,158,11,0.1); color:var(--accent); box-shadow:0 0 10px rgba(245,158,11,0.1); border:1px solid rgba(245,158,11,0.2); }

/* Settings Section (collapsible) */
.s-section { border:1px solid rgba(245,158,11,0.1); border-radius:var(--radius-md); margin-bottom:14px; overflow:hidden; }
.s-section-hdr { display:flex; align-items:center; justify-content:space-between; padding:14px 18px; background:var(--bg-card); cursor:pointer; transition:all var(--fast); border-left:2px solid transparent; }
.s-section-hdr:hover { background:var(--bg-card-hover); border-left-color:var(--accent); }
.s-section-hdr h3 { font-size:13px; font-weight:600; display:flex; align-items:center; gap:8px; text-transform:uppercase; letter-spacing:0.5px; }
.s-section-hdr .arrow { transition:transform var(--fast); color:var(--accent); font-size:12px; }
.s-section-hdr.open .arrow { transform:rotate(180deg); }
.s-section-hdr.open { border-left-color:var(--accent); }
.s-section-body { padding:0 18px; max-height:0; overflow:hidden; transition:max-height 0.3s ease,padding 0.3s ease; }
.s-section-body.open { padding:18px; max-height:5000px; }

/* Entity */
.entity-picker { background:var(--bg-card); border:1px solid rgba(245,158,11,0.1); border-radius:var(--radius-md); padding:14px; margin-bottom:14px; }
.entity-search { padding:8px 12px; background:var(--bg-input); border:1px solid rgba(245,158,11,0.1); border-radius:var(--radius-sm); color:var(--text-primary); font-size:13px; width:100%; margin-bottom:10px; outline:none; font-family:var(--mono); transition:all var(--fast); }
.entity-search:focus { border-color:var(--accent); box-shadow:0 0 12px rgba(245,158,11,0.1); }
.entity-list { max-height:400px; overflow-y:auto; border:1px solid rgba(245,158,11,0.08); border-radius:var(--radius-sm); }
.entity-item { display:flex; align-items:center; gap:10px; padding:8px 12px; cursor:pointer; font-size:12px; border-bottom:1px solid rgba(245,158,11,0.05); transition:all var(--fast); }
.entity-item:last-child { border-bottom:none; }
.entity-item:hover { background:rgba(245,158,11,0.03); border-left:2px solid var(--accent); }
.entity-item .eid { color:var(--text-muted); font-family:var(--mono); font-size:10px; }
.entity-item .ename { flex:1; font-family:var(--mono); font-size:12px; }
.selected-entities { display:flex; flex-wrap:wrap; gap:5px; margin-top:6px; }
.entity-tag { display:inline-flex; align-items:center; gap:5px; padding:3px 9px; background:var(--accent-dim); border:1px solid var(--border-accent); border-radius:16px; font-size:11px; color:var(--accent); font-family:var(--mono); }
.entity-tag .remove { cursor:pointer; opacity:0.6; font-size:13px; }
.entity-tag .remove:hover { opacity:1; }

/* Logs */
.log-entry { display:flex; gap:14px; padding:10px 14px; border-bottom:1px solid rgba(245,158,11,0.06); font-size:12px; transition:background var(--fast); }
.log-entry:hover { background:rgba(245,158,11,0.03); }
.log-time { color:var(--text-muted); font-family:var(--mono); font-size:11px; min-width:70px; }
.log-role { min-width:55px; font-weight:700; font-size:10px; text-transform:uppercase; letter-spacing:1px; font-family:var(--mono); }
.log-role.user { color:var(--blue); }
.log-role.assistant { color:var(--accent); }
.log-content { flex:1; color:var(--text-primary); line-height:1.5; }

/* Fehlerspeicher */
.err-entry { display:flex; gap:14px; padding:10px 14px; border-bottom:1px solid rgba(245,158,11,0.06); font-size:12px; align-items:flex-start; transition:background var(--fast); }
.err-entry:hover { background:rgba(245,158,11,0.03); }
.err-entry.level-ERROR { border-left:3px solid var(--danger); box-shadow:inset 4px 0 12px rgba(239,68,68,0.05); }
.err-entry.level-WARNING { border-left:3px solid var(--accent); box-shadow:inset 4px 0 12px rgba(245,158,11,0.05); }
.err-time { color:var(--text-muted); font-family:var(--mono); font-size:11px; min-width:130px; white-space:nowrap; }
.err-level { min-width:60px; font-weight:700; font-size:11px; text-transform:uppercase; font-family:var(--mono); }
.err-level.ERROR { color:var(--danger); }
.err-level.WARNING { color:var(--accent); }
.err-logger { min-width:120px; color:var(--text-muted); font-family:var(--mono); font-size:11px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.err-msg { flex:1; color:var(--text-primary); line-height:1.5; word-break:break-word; }
.err-badge { display:inline-flex; align-items:center; justify-content:center; min-width:18px; height:18px; padding:0 5px; border-radius:9px; background:var(--danger); color:white; font-size:10px; font-weight:700; margin-left:6px; }
.err-filter-bar { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.err-filter-bar .btn { font-size:10px; padding:4px 12px; border:1px solid rgba(245,158,11,0.12); }
.err-filter-bar .btn.active-filter { background:var(--accent-dim); color:var(--accent); border-color:var(--accent); box-shadow:0 0 8px rgba(245,158,11,0.15); }

/* Audit Log */
.audit-entry { display:flex; gap:14px; padding:10px 14px; border-bottom:1px solid rgba(245,158,11,0.06); font-size:12px; align-items:flex-start; transition:background var(--fast); }
.audit-entry:hover { background:rgba(245,158,11,0.03); }
.audit-time { color:var(--text-muted); font-family:var(--mono); font-size:10px; min-width:130px; white-space:nowrap; }
.audit-action { min-width:120px; font-weight:700; font-size:10px; font-family:var(--mono); padding:2px 8px; border-radius:4px; text-align:center; text-transform:uppercase; letter-spacing:0.5px; }
.audit-action.auth { background:var(--blue-dim); color:var(--blue); }
.audit-action.settings { background:var(--accent-dim); color:var(--accent); }
.audit-action.security { background:var(--danger-dim); color:var(--danger); }
.audit-action.system { background:var(--success-dim); color:var(--success); }
.audit-details { flex:1; color:var(--text-secondary); font-size:11px; word-break:break-word; }

/* Live-Status Indicator */
.live-dot { width:8px; height:8px; border-radius:50%; background:var(--success); display:inline-block; animation:livePulse 2s infinite; box-shadow:0 0 8px rgba(16,185,129,0.5); }
.live-dot.offline { background:var(--danger); animation:none; box-shadow:0 0 8px rgba(239,68,68,0.5); }
@keyframes livePulse { 0%,100%{opacity:1;box-shadow:0 0 8px rgba(16,185,129,0.5);} 50%{opacity:0.4;box-shadow:0 0 4px rgba(16,185,129,0.2);} }

/* Health Trends */
.trend-card { padding:14px; }
.trend-row { display:flex; align-items:center; gap:12px; padding:10px 0; border-bottom:1px solid rgba(245,158,11,0.06); }
.trend-row:last-child { border-bottom:none; }
.trend-label { min-width:100px; font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px; font-family:var(--mono); }
.trend-value { font-size:18px; font-weight:700; font-family:var(--mono); min-width:70px; color:var(--accent); }
.trend-unit { font-size:10px; color:var(--text-muted); font-family:var(--mono); }
.trend-arrow { font-size:14px; }
.trend-arrow.up { color:var(--danger); text-shadow:0 0 8px rgba(239,68,68,0.3); }
.trend-arrow.down { color:var(--blue); text-shadow:0 0 8px rgba(59,130,246,0.3); }
.trend-arrow.stable { color:var(--success); text-shadow:0 0 8px rgba(16,185,129,0.3); }
.trend-sparkline { flex:1; height:24px; }
.trend-period-bar { display:flex; gap:6px; margin-bottom:12px; }
.trend-period-bar button { font-size:10px; padding:3px 10px; border:1px solid rgba(245,158,11,0.15); border-radius:4px; background:transparent; color:var(--text-muted); cursor:pointer; font-family:var(--mono); text-transform:uppercase; transition:all var(--fast); }
.trend-period-bar button:hover { border-color:var(--border-accent); color:var(--text-primary); }
.trend-period-bar button.active { background:var(--accent-dim); color:var(--accent); border-color:var(--accent); box-shadow:0 0 8px rgba(245,158,11,0.15); }

/* Section Header */
.section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
.section-header h2 { font-size:16px; font-weight:600; text-transform:uppercase; letter-spacing:2px; color:var(--accent); }
.section-header p { font-size:11px; color:var(--text-muted); margin-top:3px; text-transform:uppercase; letter-spacing:1px; font-family:var(--mono); }

/* Knowledge Files */
.file-item { display:flex; align-items:center; gap:12px; padding:10px 14px; border-bottom:1px solid var(--border); font-size:12px; }
.file-name { flex:1; font-weight:500; }
.file-size { color:var(--text-muted); font-family:var(--mono); font-size:11px; }

/* Badge */
.badge { padding:3px 10px; border-radius:16px; font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:1px; font-family:var(--mono); }
.badge-ok { background:var(--success-dim); color:var(--success); border:1px solid rgba(16,185,129,0.3); }
.badge-warn { background:rgba(245,158,11,0.15); color:var(--accent); border:1px solid rgba(245,158,11,0.3); }
.badge-err { background:var(--danger-dim); color:var(--danger); border:1px solid rgba(239,68,68,0.3); }

/* Mobile */
.mobile-toggle { display:none; align-items:center; justify-content:center; width:34px; height:34px; border-radius:var(--radius-sm); background:transparent; border:1px solid var(--border-accent); cursor:pointer; font-size:16px; color:var(--accent); transition:all var(--fast); }
.mobile-toggle:hover { box-shadow:0 0 10px rgba(245,158,11,0.2); }

/* Toast */
.toast { position:fixed; bottom:20px; right:20px; padding:12px 22px; border-radius:var(--radius-sm); font-size:12px; font-weight:600; box-shadow:var(--shadow-lg); z-index:9999; transform:translateY(80px); opacity:0; transition:all 0.3s ease; text-transform:uppercase; letter-spacing:1px; font-family:var(--mono); backdrop-filter:blur(8px); }
.toast.show { transform:translateY(0); opacity:1; }
.toast-success { background:rgba(16,185,129,0.9); color:white; border:1px solid rgba(16,185,129,0.6); box-shadow:0 0 20px rgba(16,185,129,0.3); }
.toast-error { background:rgba(239,68,68,0.9); color:white; border:1px solid rgba(239,68,68,0.6); box-shadow:0 0 20px rgba(239,68,68,0.3); }
.toast-info { background:rgba(59,130,246,0.9); color:white; border:1px solid rgba(59,130,246,0.6); box-shadow:0 0 20px rgba(59,130,246,0.3); }

/* Scrollbar */
::-webkit-scrollbar { width:4px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(245,158,11,0.2); border-radius:2px; }
::-webkit-scrollbar-thumb:hover { background:rgba(245,158,11,0.4); }

/* Loading */
.spinner { width:28px; height:28px; border:2px solid rgba(245,158,11,0.15); border-top-color:var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; display:inline-block; margin-right:10px; box-shadow:0 0 10px rgba(245,158,11,0.1); }
@keyframes spin { to { transform:rotate(360deg); } }

/* Utility Classes (inline-style Ersatz) */
.flex { display:flex; }
.flex-center { display:flex; align-items:center; }
.flex-between { display:flex; align-items:center; justify-content:space-between; }
.gap-sm { gap:8px; }
.gap-md { gap:10px; }
.mt-md { margin-top:16px; }
.mb-md { margin-bottom:14px; }
.mb-0 { margin-bottom:0; }
.text-xs { font-size:10px; }
.text-sm { font-size:11px; }
.text-muted-sm { font-size:11px; color:var(--text-muted); }
.no-pad { padding:0; }

/* Settings Tab-Bar Gruppen-Divider */
.tab-bar .tab-divider { width:1px; background:rgba(245,158,11,0.12); margin:4px 4px; align-self:stretch; }

/* Dashboard Live Indicator */
.dash-live-bar { display:flex; align-items:center; gap:8px; margin-bottom:14px; }
.whisper-badge { display:none; font-size:10px; padding:2px 8px; background:var(--blue-dim); color:var(--blue); border-radius:10px; font-weight:600; }

/* Entity Browser verbessert */
.entity-list-card { padding:0; }
.entity-list-card .entity-list { max-height:500px; }
.entity-filter-bar { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-bottom:14px; }

/* Keyword tags editor */
.kw-editor { display:flex; flex-wrap:wrap; gap:4px; padding:8px; background:var(--bg-input); border:1px solid var(--border); border-radius:var(--radius-sm); min-height:36px; cursor:text; }
.kw-tag { display:inline-flex; align-items:center; gap:4px; padding:2px 8px; background:var(--accent-dim); border:1px solid var(--border-accent); border-radius:12px; font-size:11px; color:var(--accent); font-family:var(--mono); }
.kw-tag .kw-rm { cursor:pointer; opacity:0.6; }
.kw-tag .kw-rm:hover { opacity:1; }
.kw-input { border:none; background:transparent; color:var(--text-primary); font-family:var(--font); font-size:12px; outline:none; min-width:80px; flex:1; }
.entity-pick-wrap { position:relative; }
.entity-pick-dropdown { position:absolute; top:100%; left:0; right:0; max-height:200px; overflow-y:auto; background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-sm); box-shadow:0 4px 12px rgba(0,0,0,0.3); z-index:100; }
.entity-pick-item { padding:6px 10px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; gap:8px; font-size:12px; border-bottom:1px solid var(--border); }
.entity-pick-item:hover { background:var(--bg-card-hover); }
.entity-pick-item .ename { color:var(--text-primary); font-weight:500; }
.entity-pick-item .eid { color:var(--text-muted); font-family:var(--mono); font-size:10px; }

/* Chip Select — klickbare vordefinierte Optionen */
.chip-grid { display:flex; flex-wrap:wrap; gap:6px; padding:8px 0; }
.chip-opt { display:inline-flex; align-items:center; gap:4px; padding:5px 12px; background:transparent; border:1px solid rgba(245,158,11,0.12); border-radius:16px; font-size:11px; color:var(--text-secondary); cursor:pointer; transition:all var(--fast); user-select:none; text-transform:uppercase; letter-spacing:0.5px; }
.chip-opt:hover { border-color:var(--border-accent); color:var(--text-primary); background:rgba(245,158,11,0.05); }
.chip-opt.selected { background:var(--accent-dim); border-color:var(--accent); color:var(--accent); font-weight:600; box-shadow:0 0 10px rgba(245,158,11,0.15); }
.chip-opt.selected::before { content:'✓ '; font-size:10px; }

/* Info-Hint Box */
.info-box { display:flex; align-items:flex-start; gap:8px; padding:10px 14px; background:var(--blue-dim); border:1px solid rgba(59,130,246,0.2); border-radius:var(--radius-sm); margin-bottom:14px; font-size:12px; color:var(--text-secondary); line-height:1.5; }
.info-box .info-icon { font-size:14px; flex-shrink:0; margin-top:1px; }

/* ---- Jarvis Boot Sequence ---- */
.boot-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-primary); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
.boot-hud { position: relative; width: 180px; height: 180px; margin-bottom: 40px; }
.boot-circle { width: 100%; height: 100%; animation: bootRotate 3s linear infinite; }
.boot-ring { fill: none; stroke: rgba(245,158,11,0.15); stroke-width: 2; }
.boot-ring-fill { fill: none; stroke: var(--accent); stroke-width: 2; stroke-dasharray: 565; stroke-dashoffset: 565; stroke-linecap: round; animation: bootDraw 2s ease-out forwards; }
.boot-logo { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 56px; font-weight: 700; color: var(--accent); opacity: 0; animation: bootFadeIn 0.6s ease 0.3s forwards; text-shadow: 0 0 30px rgba(245,158,11,0.5); }
.boot-text { font-family: var(--mono); font-size: 14px; color: var(--accent); letter-spacing: 2px; min-height: 20px; text-transform: uppercase; }
.boot-systems { display: flex; gap: 12px; margin-top: 24px; }
.boot-sys { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-muted); opacity: 0; animation: bootFadeIn 0.3s ease forwards; }
.boot-sys .sys-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--text-muted); transition: background 0.3s; }
.boot-sys.online .sys-dot { background: var(--success); }
.boot-sys.online { color: var(--text-secondary); }
.boot-screen.fade-out { animation: bootFadeOut 0.5s ease forwards; }
@keyframes bootDraw { to { stroke-dashoffset: 0; } }
@keyframes bootRotate { to { transform: rotate(360deg); } }
@keyframes bootFadeIn { to { opacity: 1; } }
@keyframes bootFadeOut { to { opacity: 0; pointer-events: none; } }
</style>
</head>
<body>

<!-- SETUP (erstmaliger Aufruf) -->
<div id="setupScreen" class="login-screen" style="display:none;">
  <div class="login-box">
    <div class="login-icon">&#9881;</div>
    <h1>JARVIS</h1>
    <p>Ersteinrichtung — PIN festlegen</p>
    <input type="password" id="setupPin" maxlength="16" placeholder="PIN waehlen"
           onkeydown="if(event.key==='Enter')document.getElementById('setupPinConfirm').focus()">
    <input type="password" id="setupPinConfirm" maxlength="16" placeholder="PIN bestaetigen"
           onkeydown="if(event.key==='Enter')doSetup()">
    <button onclick="doSetup()">PIN setzen</button>
    <div id="setupError" class="login-error"></div>
  </div>
</div>

<!-- RECOVERY KEY anzeigen (nach Setup) -->
<div id="recoveryScreen" class="login-screen" style="display:none;">
  <div class="login-box">
    <div class="login-icon">&#128273;</div>
    <h1>Recovery-Key</h1>
    <p class="recovery-hint">Diesen Schluessel sicher aufbewahren!</p>
    <p class="recovery-desc">Falls du deinen PIN vergisst, kannst du ihn nur mit diesem Key zuruecksetzen. Er wird nur einmal angezeigt.</p>
    <div id="recoveryKeyDisplay" class="recovery-key-display"></div>
    <button onclick="recoveryAcknowledged()">Ich habe den Key gespeichert</button>
  </div>
</div>

<!-- LOGIN -->
<div id="loginScreen" class="login-screen" style="display:none;">
  <div class="login-box">
    <div class="login-hud-ring">
      <svg viewBox="0 0 120 120">
        <circle class="login-hud-arc" cx="60" cy="60" r="54" />
        <circle class="login-hud-arc-inner" cx="60" cy="60" r="46" />
      </svg>
    </div>
    <div class="login-corner tl"></div>
    <div class="login-corner tr"></div>
    <div class="login-corner bl"></div>
    <div class="login-corner br"></div>
    <div class="login-scan-line"></div>
    <h1>JARVIS</h1>
    <p>MindHome Assistant</p>
    <input type="password" id="pinInput" maxlength="16" placeholder="PIN" autofocus
           onkeydown="if(event.key==='Enter')doLogin()">
    <button onclick="doLogin()">Authentifizieren</button>
    <div id="loginError" class="login-error"></div>
    <div class="forgot-pin">
      <a href="#" onclick="showResetScreen();return false;">PIN vergessen?</a>
    </div>
  </div>
</div>

<!-- PIN RESET -->
<div id="resetScreen" class="login-screen" style="display:none;">
  <div class="login-box">
    <div class="login-icon">&#128273;</div>
    <h1>PIN zuruecksetzen</h1>
    <p>Recovery-Key eingeben</p>
    <input type="text" id="resetRecoveryKey" maxlength="16" placeholder="Recovery-Key" class="reset-input"
           onkeydown="if(event.key==='Enter')document.getElementById('resetNewPin').focus()">
    <input type="password" id="resetNewPin" maxlength="16" placeholder="Neuer PIN"
           onkeydown="if(event.key==='Enter')document.getElementById('resetNewPinConfirm').focus()">
    <input type="password" id="resetNewPinConfirm" maxlength="16" placeholder="Neuer PIN bestaetigen"
           onkeydown="if(event.key==='Enter')doResetPin()">
    <button onclick="doResetPin()">PIN zuruecksetzen</button>
    <div id="resetError" class="login-error"></div>
    <div class="forgot-pin">
      <a href="#" onclick="showLoginScreen();return false;">Zurueck zur Anmeldung</a>
    </div>
  </div>
</div>

<!-- NEUER RECOVERY KEY (nach Reset) -->
<div id="newRecoveryScreen" class="login-screen" style="display:none;">
  <div class="login-box">
    <div class="login-icon">&#128273;</div>
    <h1>Neuer Recovery-Key</h1>
    <p class="recovery-hint">Neuen Schluessel sicher aufbewahren!</p>
    <p class="recovery-desc">Der alte Recovery-Key ist ungueltig. Dieser neue Key wird nur einmal angezeigt.</p>
    <div id="newRecoveryKeyDisplay" class="recovery-key-display"></div>
    <button onclick="newRecoveryAcknowledged()">Ich habe den Key gespeichert</button>
  </div>
</div>

<!-- APP -->
<div id="app" class="app">
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">J</div>
      <div><h2>JARVIS</h2><span>MindHome Assistant</span></div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" data-page="dashboard"><span class="nav-icon">&#9632;</span>Dashboard</div>
      <div class="nav-item" data-page="settings"><span class="nav-icon">&#9881;</span>Einstellungen</div>
      <div class="nav-item" data-page="entities"><span class="nav-icon">&#8801;</span>Entities</div>
      <div class="nav-item" data-page="knowledge"><span class="nav-icon">&#128218;</span>Wissen</div>
      <div class="nav-item" data-page="logs"><span class="nav-icon">&#9776;</span>Logs</div>
      <div class="nav-item" data-page="errors"><span class="nav-icon">&#9888;</span>Fehler<span id="errBadge" class="err-badge" style="display:none;">0</span></div>
    </nav>
    <div class="sidebar-footer">MindHome Assistant v1.4.1</div>
  </aside>

  <div class="main">
    <header class="main-header">
      <div class="flex-center gap-md">
        <div class="mobile-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">&#9776;</div>
        <h1 id="pageTitle">Dashboard</h1>
      </div>
      <div class="flex-center gap-md">
        <span id="statusBadge" class="badge badge-ok">Online</span>
        <button class="btn btn-sm btn-secondary" onclick="doLogout()">Abmelden</button>
      </div>
    </header>

    <div class="main-content">
      <!-- ============ DASHBOARD ============ -->
      <div id="page-dashboard" class="page active">
        <div class="dash-live-bar">
          <span id="liveIndicator" class="live-dot"></span>
          <span class="text-muted-sm" id="liveTimestamp">—</span>
          <span id="whisperBadge" class="whisper-badge">Flüstermodus</span>
        </div>
        <div id="dashStats" class="grid grid-4"></div>
        <div class="grid grid-2 mt-md">
          <div class="card"><div class="card-header"><h3>Komponenten</h3></div><div id="compList"></div></div>
          <div class="card"><div class="card-header"><h3>Status</h3></div><div id="moodInfo"></div></div>
        </div>
        <div class="card mt-md">
          <div class="card-header flex-between">
            <h3>Raumklima</h3>
            <div class="trend-period-bar" id="trendPeriodBar">
              <button class="active" onclick="loadHealthTrends(24)">24h</button>
              <button onclick="loadHealthTrends(48)">48h</button>
              <button onclick="loadHealthTrends(168)">7 Tage</button>
            </div>
          </div>
          <div id="healthTrendsContainer" class="trend-card"></div>
        </div>
      </div>

      <!-- ============ SETTINGS ============ -->
      <div id="page-settings" class="page">
        <div class="section-header">
          <div><h2>Einstellungen</h2><p>Alle Konfigurationen aus settings.yaml</p></div>
          <button class="btn btn-primary" onclick="saveAllSettings()">Speichern</button>
        </div>
        <!-- Settings Tabs (gruppiert) -->
        <div class="tab-bar" id="settingsTabBar">
          <!-- Basis -->
          <div class="tab-item active" data-tab="tab-general">Allgemein</div>
          <div class="tab-item" data-tab="tab-persons">Personen</div>
          <div class="tab-divider"></div>
          <!-- KI & Persoenlichkeit -->
          <div class="tab-item" data-tab="tab-personality">Persönlichkeit</div>
          <div class="tab-item" data-tab="tab-memory">Gedächtnis</div>
          <div class="tab-item" data-tab="tab-mood">Stimmung</div>
          <div class="tab-item" data-tab="tab-autonomie">KI-Autonomie</div>
          <div class="tab-divider"></div>
          <!-- Haus -->
          <div class="tab-item" data-tab="tab-rooms">Räume</div>
          <div class="tab-item" data-tab="tab-devices">Geräte</div>
          <div class="tab-item" data-tab="tab-covers">Rollläden</div>
          <div class="tab-item" data-tab="tab-routines">Routinen</div>
          <div class="tab-divider"></div>
          <!-- System -->
          <div class="tab-item" data-tab="tab-voice">Stimme</div>
          <div class="tab-item" data-tab="tab-security">Sicherheit</div>
          <div class="tab-item" data-tab="tab-eastereggs">Easter Eggs</div>
          <div class="tab-item" data-tab="tab-system">System</div>
        </div>
        <div id="settingsContent"></div>
      </div>

      <!-- ============ ENTITIES ============ -->
      <div id="page-entities" class="page">
        <div class="section-header">
          <div><h2>Home Assistant Entities</h2><p>Alle Entities — klicke zum Kopieren</p></div>
          <button class="btn btn-secondary" onclick="loadEntities()">Aktualisieren</button>
        </div>
        <div class="entity-filter-bar">
          <div class="form-group mb-0">
            <select id="entityDomainFilter" onchange="filterEntities()"><option value="">Alle Domains</option></select>
          </div>
          <div class="form-group mb-0">
            <input type="text" id="entitySearchInput" placeholder="Entity suchen..." oninput="filterEntities()">
          </div>
        </div>
        <div class="card entity-list-card"><div id="entityBrowser" class="entity-list"></div></div>
      </div>

      <!-- ============ KNOWLEDGE ============ -->
      <div id="page-knowledge" class="page">
        <div class="section-header">
          <div><h2>Wissensdatenbank</h2><p>Dateien in config/knowledge/ — RAG-Quelle</p></div>
          <button class="btn btn-primary" onclick="ingestKnowledge()">Neu einlesen</button>
        </div>
        <div id="kbStats" class="grid grid-3" style="margin-bottom:16px;"></div>
        <div class="card"><div class="card-header"><h3>Dateien</h3></div><div id="kbFiles"></div></div>
      </div>

      <!-- ============ LOGS ============ -->
      <div id="page-logs" class="page">
        <div class="section-header">
          <div><h2>Protokolle</h2><p>Gespraeche und Audit-Ereignisse</p></div>
          <button class="btn btn-secondary" onclick="currentLogTab==='conversations'?loadLogs():loadAudit()">Aktualisieren</button>
        </div>
        <div class="tab-bar" id="logsTabBar" style="margin-bottom:14px;">
          <div class="tab-item active" data-logtab="conversations" onclick="switchLogTab('conversations')">Gespraeche</div>
          <div class="tab-item" data-logtab="activities" onclick="switchLogTab('activities')">Aktivitaeten</div>
          <div class="tab-item" data-logtab="audit" onclick="switchLogTab('audit')">Audit-Log</div>
        </div>
        <div class="card" style="padding:0;">
          <div id="logsContainer"></div>
          <div id="activitiesContainer" style="display:none;"></div>
          <div id="auditContainer" style="display:none;"></div>
        </div>
      </div>

      <div id="page-errors" class="page">
        <div class="section-header">
          <div><h2>Fehlerspeicher</h2><p>Letzte Warnungen und Fehler des Assistenten</p></div>
          <div class="err-filter-bar">
            <button class="btn btn-secondary active-filter" id="errFilterAll" onclick="filterErrors('')">Alle</button>
            <button class="btn btn-secondary" id="errFilterError" onclick="filterErrors('ERROR')">Fehler</button>
            <button class="btn btn-secondary" id="errFilterWarn" onclick="filterErrors('WARNING')">Warnungen</button>
            <button class="btn btn-secondary" onclick="loadErrors()">Aktualisieren</button>
            <button class="btn btn-danger" onclick="clearErrors()">Leeren</button>
          </div>
        </div>
        <div class="card" style="padding:0;"><div id="errorsContainer"></div></div>
        <div style="margin-top:8px;font-size:11px;color:var(--text-muted);" id="errorsInfo"></div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast"></div>

<!-- BOOT SCREEN -->
<div id="bootScreen" class="boot-screen" style="display:none;">
  <div class="boot-hud">
    <svg class="boot-circle" viewBox="0 0 200 200">
      <circle class="boot-ring" cx="100" cy="100" r="90" />
      <circle class="boot-ring-fill" cx="100" cy="100" r="90" />
    </svg>
    <div class="boot-logo">J</div>
  </div>
  <div class="boot-text" id="bootText"></div>
  <div class="boot-systems" id="bootSystems"></div>
</div>

<script src="app.js"></script>
</body>
</html>
